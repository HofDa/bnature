---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { content, type Lang } from '../../data/content';
import { legalContent, type LegalSlug } from '../../data/legal';
import bnatureLogo from '../../assets/bnature-logo.svg';
import '../../styles/globals.css';

type Params = {
  lang: Lang;
  legal: LegalSlug;
};

export const getStaticPaths = () => {
  const langs: Lang[] = ['de', 'it'];
  const docs: LegalSlug[] = ['impressum', 'privacy', 'cookies'];

  return langs.flatMap((lang) => docs.map((legal) => ({ params: { lang, legal } })));
};

const { lang, legal } = Astro.params as Params;

if (!(lang in legalContent) || !(legal in legalContent[lang])) {
  throw new Error(`Unsupported legal route: ${lang}/${legal}`);
}

const page = legalContent[lang][legal];
const backLabel = lang === 'de' ? 'Zur Startseite' : 'Torna alla home';
const homepageTitle = content[lang].title;
const canonicalPath = `/${lang}/${legal}`;
const alternateDePath = `/de/${legal}`;
const alternateItPath = `/it/${legal}`;
const withBase = (path: string) => {
  const base = import.meta.env.BASE_URL.endsWith('/') ? import.meta.env.BASE_URL : `${import.meta.env.BASE_URL}/`;
  return `${base}${path.replace(/^\/+/, '')}`;
};
---
<BaseLayout
  lang={lang}
  title={`${page.title} | b*nature`}
  description={page.description}
  canonicalPath={canonicalPath}
  alternateDePath={alternateDePath}
  alternateItPath={alternateItPath}
>
  <main class="font-body text-bark-700">
    <section class="section">
      <div class="container max-w-4xl">
        <a href={withBase(`/${lang}`)} class="text-sm text-primary-700 hover:underline">{backLabel}</a>
        <h1 class="h1 mt-4 text-4xl md:text-5xl">{page.title}</h1>
        <p class="mt-3 text-sm text-bark-700/70">{page.updated}</p>
        <p class="lead mt-4">{page.description}</p>

        <div class="mt-8 space-y-5">
          {legal === 'impressum' && (
            <article class="card p-6">
              <h2 class="text-xl font-semibold text-bark-700">
                {lang === 'de' ? 'Projekt und Organisation' : 'Progetto e organizzazione'}
              </h2>
              <div class="mt-4 flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
                <div>
                  <p class="text-bark-700/90">
                    {lang === 'de'
                      ? 'b*nature ist Teil von b*coop.'
                      : 'b*nature fa parte di b*coop.'}
                  </p>
                  <a
                    href="https://bcoop.bz/"
                    target="_blank"
                    rel="noopener noreferrer"
                    class="mt-1 inline-block text-primary-700 hover:underline"
                  >
                    https://bcoop.bz/
                  </a>
                </div>
                <a href="https://bcoop.bz/" target="_blank" rel="noopener noreferrer" aria-label="b*coop website">
                  <img src={bnatureLogo.src} alt="b*nature logo" class="h-10 w-auto" loading="lazy" decoding="async" />
                </a>
              </div>
            </article>
          )}

          {page.sections.map((section) => (
            <article class="card p-6">
              <h2 class="text-xl font-semibold text-bark-700">{section.heading}</h2>
              {
                section.body.length > 1 ? (
                  <ul class="mt-3 list-disc space-y-2 pl-5 text-bark-700/90">
                    {section.body.map((line) => (
                      <li>{line}</li>
                    ))}
                  </ul>
                ) : (
                  <p class="mt-3 text-bark-700/90">{section.body[0]}</p>
                )
              }
            </article>
          ))}
        </div>

        <p class="mt-10 text-sm text-bark-700/70">{homepageTitle}</p>
      </div>
    </section>
  </main>
</BaseLayout>
