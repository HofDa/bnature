---
import BaseLayout from '../../layouts/BaseLayout.astro';
import LandingPage from '../../components/LandingPage.astro';
import { content, type Lang } from '../../data/content';
import heroImg from '../../assets/hero.webp';
import '../../styles/globals.css';

export const getStaticPaths = () => {
  const langs: Lang[] = ['de', 'it'];
  return langs.map((lang) => ({ params: { lang } }));
};

const lang = Astro.params.lang as Lang;
if (!(lang in content)) {
  throw new Error(`Unsupported language: ${lang}`);
}

const t = content[lang];
const canonicalPath = `/${lang}`;
const alternateDePath = '/de';
const alternateItPath = '/it';

const withBase = (path: string) => {
  const base = import.meta.env.BASE_URL.endsWith('/') ? import.meta.env.BASE_URL : `${import.meta.env.BASE_URL}/`;
  return `${base}${path.replace(/^\/+/, '')}`;
};

const websiteSchema = {
  '@context': 'https://schema.org',
  '@type': 'WebSite',
  name: 'b*nature',
  url: new URL(withBase(canonicalPath), Astro.site ?? new URL('https://example.com')).toString(),
  inLanguage: lang,
};

const organizationSchema = {
  '@context': 'https://schema.org',
  '@type': 'Organization',
  name: 'b*nature',
  url: new URL(withBase(canonicalPath), Astro.site ?? new URL('https://example.com')).toString(),
  email: 'info@bnature.bz',
  logo: new URL(heroImg.src, Astro.site ?? new URL('https://example.com')).toString(),
};

const jsonLd = JSON.stringify([websiteSchema, organizationSchema]);
---
<BaseLayout
  lang={lang}
  title={t.title}
  description={t.description}
  canonicalPath={canonicalPath}
  alternateDePath={alternateDePath}
  alternateItPath={alternateItPath}
  ogImagePath={heroImg.src}
>
  <script type="application/ld+json" set:html={jsonLd}></script>
  <LandingPage lang={lang} />
</BaseLayout>
